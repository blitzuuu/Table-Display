<!-- JS changes: treat `name` as matching team.name OR players, and give war-center spans highlight/normal classes -->
<script>
  // Helper to check player membership or a team-name match (case-insensitive)
  function playerInTeam(team, player) {
      if (!player) return false;
      const lower = player.toLowerCase();
      // match against any player name
      if (Array.isArray(team.players) && team.players.some(p => p.toLowerCase() === lower)) return true;
      // also match when the provided name equals the team name
      if ((team.name || "").toLowerCase() === lower) return true;
      return false;
  }

  // ...other functions unchanged...

  function renderWarCenter(container, parsed, playerName) {
      // Safety checks
      if (!parsed || parsed.type !== 'teams' || parsed.teams.length !== 2) return;

      // helper to test if a team contains the player or matches the team name (case-insensitive)
      function teamHasPlayerOrName(team, playerName) {
          if (!playerName) return false;
          const lower = playerName.toLowerCase();
          if (Array.isArray(team.players) && team.players.some(p => p.toLowerCase() === lower)) return true;
          if ((team.name || "").toLowerCase() === lower) return true;
          return false;
      }

      const teamA = parsed.teams[0];
      const teamB = parsed.teams[1];

      // Decide left/right team (unchanged)
      let leftTeam, rightTeam;
      const aHas = teamHasPlayerOrName(teamA, playerName);
      const bHas = teamHasPlayerOrName(teamB, playerName);

      if (aHas && !bHas) {
          leftTeam = teamA; rightTeam = teamB;
      } else if (bHas && !aHas) {
          leftTeam = teamB; rightTeam = teamA;
      } else {
          const aName = (teamA.name || "").toLowerCase();
          const bName = (teamB.name || "").toLowerCase();
          if (aName.localeCompare(bName) <= 0) { leftTeam = teamA; rightTeam = teamB; }
          else { leftTeam = teamB; rightTeam = teamA; }
      }

      // ...measuring code unchanged...

      // Build DOM nodes
      const wrapper = document.createElement('div');
      wrapper.className = 'war-center';

      // Left Tag (Box A)
      const leftTagBox = document.createElement('div');
      leftTagBox.className = 'war-box tag';
      leftTagBox.style.width = boxAWidth + 'px';
      leftTagBox.style.textAlign = 'left';
      const leftTagSpan = document.createElement('span');
      // apply highlight or normal class so CSS color rules apply consistently
      leftTagSpan.className = 'text left-align ' + (aHas ? 'text-highlight' : 'text-normal');
      leftTagSpan.textContent = tagLeft;
      leftTagBox.appendChild(leftTagSpan);

      // Left Score (Box B)
      const leftScoreBox = document.createElement('div');
      leftScoreBox.className = 'war-box score';
      leftScoreBox.style.width = boxBWidth + 'px';
      leftScoreBox.style.textAlign = 'left';
      const leftScoreSpan = document.createElement('span');
      leftScoreSpan.className = 'text left-align ' + (aHas ? 'text-highlight' : 'text-normal');
      leftScoreSpan.textContent = scoreLeft;
      leftScoreBox.appendChild(leftScoreSpan);

      // Race Count (Box C)
      const raceBox = document.createElement('div');
      raceBox.className = 'war-box race';
      raceBox.style.width = boxCWidth + 'px';
      raceBox.style.textAlign = 'center';
      const raceSpan = document.createElement('span');
      raceSpan.className = 'text center-align';
      raceSpan.textContent = raceLabel;
      raceBox.appendChild(raceSpan);

      // Right Score (Box B)
      const rightScoreBox = document.createElement('div');
      rightScoreBox.className = 'war-box score';
      rightScoreBox.style.width = boxBWidth + 'px';
      rightScoreBox.style.textAlign = 'right';
      const rightScoreSpan = document.createElement('span');
      rightScoreSpan.className = 'text right-align ' + (bHas ? 'text-highlight' : 'text-normal');
      rightScoreSpan.textContent = scoreRight;
      rightScoreBox.appendChild(rightScoreSpan);

      // Right Tag (Box A)
      const rightTagBox = document.createElement('div');
      rightTagBox.className = 'war-box tag';
      rightTagBox.style.width = boxAWidth + 'px';
      rightTagBox.style.textAlign = 'right';
      const rightTagSpan = document.createElement('span');
      rightTagSpan.className = 'text right-align ' + (bHas ? 'text-highlight' : 'text-normal');
      rightTagSpan.textContent = tagRight;
      rightTagBox.appendChild(rightTagSpan);

      // Append in order...
      wrapper.appendChild(leftTagBox);
      wrapper.appendChild(leftScoreBox);
      wrapper.appendChild(raceBox);
      wrapper.appendChild(rightScoreBox);
      wrapper.appendChild(rightTagBox);

      container.innerHTML = '';
      container.appendChild(wrapper);
      container.style.textAlign = 'center';
  }
</script>
