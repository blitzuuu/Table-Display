<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Config Page</title>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      try {
        // Get the 'name' and 'tableid' query parameters from the URL
        const urlParams = new URLSearchParams(window.location.search);
        const name = urlParams.get("name");
        const currentTableId = urlParams.get("tableid") || "";

        // Ensure the 'name' parameter is present
        if (!name) {
          document.body.innerHTML = "<h1>Error</h1><p>The config page cannot be used without a valid 'name' parameter in the URL.</p>";
          return;
        }

        // Display the current 'name' and allow modifications to the 'tableid'
        document.getElementById("name-display").innerText = `Configuring settings for: ${name}`;

        // Pre-fill the input field with the current 'tableid'
        const tableIdInput = document.getElementById("tableid-input");
        tableIdInput.value = currentTableId;

        // Save button functionality
        document.getElementById("save-btn").addEventListener("click", () => {
          const newTableId = tableIdInput.value.trim();

          // Validate the new 'tableid'
          if (!newTableId) {
            document.getElementById("status-message").innerText = "Error: Table ID cannot be empty!";
            document.getElementById("status-message").style.color = "red";
            return;
          }

          // Broadcast the updated table ID to any listening pages using BroadcastChannel
          const channel = new BroadcastChannel("table_config_channel");
          channel.postMessage({ name, tableid: newTableId });

          // Update the status message
          document.getElementById("status-message").innerText = "Configuration saved!";
          document.getElementById("status-message").style.color = "green";
        });
      } catch (error) {
        console.error("Error:", error);
        document.body.innerHTML = "<h1>Error</h1><p>An unexpected error occurred. Please try again later.</p>";
      }
    });
  </script>
</head>
<body>
  <h1>Config Page</h1>
  <p id="name-display"></p>
  <label for="tableid-input">Table ID:</label>
  <input type="text" id="tableid-input" placeholder="Enter table ID" />
  <button id="save-btn">Save Changes</button>
  <p id="status-message"></p>
</body>
</html>
